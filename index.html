<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Degeneracy</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
</head>
<body>
    <based-page data-url="/index.html">
        <h1>index.html</h1>
        <button onclick="SPA_navigate('/test1.html')">Goto TEST1</button>
        <button onclick="SPA_navigate('/test2.html')">Goto TEST2</button>
        <button onclick="SPA_navigate('/404')">crash and burn</button>
    </based-page>
    <based-page data-url="/test1.html">
        <h1>test1.html</h1>
        <button onclick="SPA_navigate('/index.html')">Goto INDEX</button>
        <button onclick="SPA_navigate('/test2.html')">Goto TEST2</button>
        <button onclick="SPA_navigate('/404')">crash and burn</button>
    </based-page>
    <based-page data-url="/test2.html">
        <h1>test2.html</h1>
        <button onclick="SPA_navigate('/test1.html')">Goto TEST1</button>
        <button onclick="SPA_navigate('/index.html')">Goto INDEX</button>
        <button onclick="SPA_navigate('/404')">crash and burn</button>
    </based-page>
    <div id="main">
    </div>
</body>
    <script>
        class BasedPage extends HTMLElement {
            constructor() {
                super();
            }
        }

        customElements.define('based-page',BasedPage);
        
        var pages = {};

        function SPA_switch_to_shitty_history_mode() {
            if (window.location.href.includes("#")) return;
            window.location.href = window.location.href + '#/';
        }
        function SPA_init_the_fucking_page() {
            let elements = Array.from(document.querySelector('body').querySelectorAll('based-page'));
            elements.forEach(x=>{
                pages[x.dataset['url']] = x.innerHTML;
                x.parentElement.removeChild(x); //b1g code ðŸ˜Ž
            });
        }
        function SPA_do_update_content_refresh_lol() {
            const path = window.location.href.split('#').filter((v,i,a)=>i!=0).join('');
            console.log({path,pages});
            console.log(pages[path]);
            document.querySelector('#main').innerHTML = pages[path] || `<h1 style="color:red;">B1G error 404 our coders cant find your page</h1><p>Big sad :(</p>`

            console.log(`im @ ${path}`);
        }
        function SPA_navigate(path) {
            window.location.href = `${window.location.href.split('#')[0]}#${path}`;
            SPA_do_update_content_refresh_lol(); 
        }
        
        window.addEventListener('popstate',SPA_do_update_content_refresh_lol);
        SPA_switch_to_shitty_history_mode();
        SPA_init_the_fucking_page();
        SPA_do_update_content_refresh_lol();
    </script>    
</html>
